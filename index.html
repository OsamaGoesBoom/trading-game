<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <title>QUANTUM APEX // SECURE_COMMAND</title>
    <style>
        :root { 
            --bg: #010409; --panel: #0d1117; --border: #30363d;
            --cyan: #58a6ff; --magenta: #bc8cff; --green: #3fb950; --red: #f85149; --gold: #d29922;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: var(--bg); color: #c9d1d9; height: 100vh; overflow: hidden; font-size: 13px; }

        /* AUTH SCREENS */
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 30px; width: 100%; max-width: 400px; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
        
        .tab-container { display: flex; margin-bottom: 20px; border-bottom: 1px solid var(--border); }
        .auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: #8b949e; }
        .auth-tab.active { color: var(--cyan); border-bottom: 2px solid var(--cyan); font-weight: bold; }

        /* GAME INTERFACE */
        .app { display: grid; grid-template-columns: 280px 1fr 300px; grid-template-rows: 60px 1fr 40px; height: 100vh; gap: 8px; padding: 8px; visibility: hidden; }
        .box { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; padding: 12px; display: flex; flex-direction: column; overflow: hidden; }
        
        .btn { padding: 10px 15px; border: 1px solid var(--border); border-radius: 6px; font-weight: 600; cursor: pointer; transition: 0.2s; background: #21262d; color: #c9d1d9; width: 100%; margin: 5px 0; }
        .btn:hover { background: #30363d; }
        .btn-primary { background: var(--cyan); color: #fff; border: none; }
        
        input { background: #0d1117; border: 1px solid var(--border); padding: 12px; color: #fff; border-radius: 6px; width: 100%; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--cyan); }

        canvas { background: #010409; flex-grow: 1; border: 1px solid var(--border); border-radius: 6px; }
        .ticker-list { overflow-y: auto; flex-grow: 1; }
        .ticker { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border); cursor: pointer; }
        .active-t { background: #1c2128; border-left: 3px solid var(--cyan); }
    </style>
</head>
<body>

    <div id="authScreen" class="overlay">
        <div class="card">
            <h2 style="text-align: center; margin-bottom: 20px;">QA_CORE_AUTH</h2>
            <div class="tab-container">
                <div id="loginTab" class="auth-tab active" onclick="toggleAuth('login')">LOGIN</div>
                <div id="signupTab" class="auth-tab" onclick="toggleAuth('signup')">SIGN UP</div>
            </div>
            
            <input type="text" id="authUser" placeholder="Terminal ID">
            <input type="password" id="authPass" placeholder="Access Code">
            <button id="authBtn" class="btn btn-primary" onclick="handleAuth()">INITIALIZE SESSION</button>
            <p id="authMsg" style="color: var(--red); font-size: 11px; margin-top: 10px; text-align: center;"></p>
        </div>
    </div>

    <div class="app" id="app">
        <header class="box" style="grid-column: span 3; flex-direction: row; align-items: center; justify-content: space-between;">
            <div><span style="color:var(--cyan)">QA</span>_SECURE_LINK // <span id="displayUser" style="color:var(--magenta)"></span></div>
            <div id="cashDisp" style="font-size: 20px; color: var(--green); font-weight: bold;">$0</div>
        </header>

        <aside class="box"><div class="ticker-list" id="stockList"></div></aside>

        <main class="box">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h2 id="sName">--</h2>
                <div id="sPrice" style="font-size: 24px;">$0.00</div>
            </div>
            <canvas id="chart"></canvas>
        </main>

        <aside class="box">
            <p style="color: #8b949e; margin-bottom: 5px;">POSITION_DATA</p>
            <div id="qtyDisp" style="font-size: 18px; margin-bottom: 15px;">Units: 0</div>
            <button class="btn" style="color: var(--green); border-color: var(--green);" onclick="trade(1)">BUY</button>
            <button class="btn" style="color: var(--red); border-color: var(--red);" onclick="trade(-1)">SELL</button>
            <button class="btn" style="margin-top: auto;" onclick="logout()">TERMINATE SESSION</button>
        </aside>
    </div>

    <script>
        let currentUser = null;
        let mode = 'login';
        const Game = { cash: 10000, port: {}, active: null };
        const Stocks = [];
        const cvs = document.getElementById('chart'), ctx = cvs.getContext('2d');

        function toggleAuth(m) {
            mode = m;
            document.getElementById('loginTab').classList.toggle('active', m === 'login');
            document.getElementById('signupTab').classList.toggle('active', m === 'signup');
            document.getElementById('authBtn').innerText = m === 'login' ? 'INITIALIZE SESSION' : 'CREATE IDENTITY';
        }

        function handleAuth() {
            const user = document.getElementById('authUser').value.trim();
            const pass = document.getElementById('authPass').value.trim();
            const msg = document.getElementById('authMsg');

            if(!user || !pass) { msg.innerText = "Error: Credentials incomplete."; return; }

            let registry = JSON.parse(localStorage.getItem('QA_USER_REGISTRY') || '{}');

            if(mode === 'signup') {
                if(registry[user]) { msg.innerText = "Error: ID already exists."; return; }
                registry[user] = { pass: pass, save: { cash: 10000, port: {} } };
                localStorage.setItem('QA_USER_REGISTRY', JSON.stringify(registry));
                msg.style.color = "var(--green)";
                msg.innerText = "Identity Created. Please Login.";
                toggleAuth('login');
            } else {
                if(!registry[user] || registry[user].pass !== pass) { msg.innerText = "Error: Invalid ID or Code."; return; }
                currentUser = user;
                Game.cash = registry[user].save.cash;
                Game.port = registry[user].save.port;
                launchGame();
            }
        }

        function launchGame() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('app').style.visibility = 'visible';
            document.getElementById('displayUser').innerText = currentUser.toUpperCase();
            generateMarket();
            viewStock(Stocks[0].sym);
            setInterval(tick, 1000);
            resize();
        }

        function saveProgress() {
            let registry = JSON.parse(localStorage.getItem('QA_USER_REGISTRY'));
            registry[currentUser].save = { cash: Game.cash, port: Game.port };
            localStorage.setItem('QA_USER_REGISTRY', JSON.stringify(registry));
        }

        function logout() { location.reload(); }

        // --- GAME ENGINE ---
        function generateMarket() {
            const names = ["Nvidia", "Apple", "Tesla", "Cyber", "Bio", "Solar", "Grid", "Space"];
            for(let i=0; i<names.length; i++) {
                Stocks.push({ name: names[i], sym: names[i].substring(0,3).toUpperCase(), price: 100 + Math.random()*500, hist: [] });
            }
            const list = document.getElementById('stockList');
            Stocks.forEach(s => {
                list.innerHTML += `<div class="ticker" id="tk-${s.sym}" onclick="viewStock('${s.sym}')"><b>${s.sym}</b><span id="p-${s.sym}">$0</span></div>`;
            });
        }

        function viewStock(sym) {
            Game.active = Stocks.find(s => s.sym === sym);
            document.querySelectorAll('.ticker').forEach(e => e.classList.remove('active-t'));
            document.getElementById('tk-'+sym).classList.add('active-t');
            document.getElementById('sName').innerText = Game.active.name;
        }

        function tick() {
            Stocks.forEach(s => {
                let open = s.price;
                s.price += (Math.random() - 0.5) * 5;
                s.hist.push({o: open, c: s.price, h: Math.max(open, s.price)+2, l: Math.min(open, s.price)-2});
                if(s.hist.length > 50) s.hist.shift();
                document.getElementById(`p-${s.sym}`).innerText = `$${s.price.toFixed(2)}`;
            });
            draw(); updateUI();
        }

        function trade(dir) {
            const s = Game.active;
            if(!Game.port[s.sym]) Game.port[s.sym] = 0;
            if(dir === 1 && Game.cash >= s.price) { Game.cash -= s.price; Game.port[s.sym]++; }
            else if(dir === -1 && Game.port[s.sym] > 0) { Game.cash += s.price; Game.port[s.sym]--; }
            saveProgress();
        }

        function draw() {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            const h = Game.active.hist; if(h.length < 2) return;
            const min = Math.min(...h.map(x=>x.l)), max = Math.max(...h.map(x=>x.h)), range = max-min;
            const w = cvs.width / 50;
            h.forEach((d, i) => {
                const x = i * w + (w/2), color = d.c >= d.o ? '#3fb950' : '#f85149';
                const yO = cvs.height - ((d.o-min)/range * cvs.height);
                const yC = cvs.height - ((d.c-min)/range * cvs.height);
                ctx.strokeStyle = color; ctx.beginPath();
                ctx.moveTo(x, cvs.height - ((d.h-min)/range * cvs.height));
                ctx.lineTo(x, cvs.height - ((d.l-min)/range * cvs.height)); ctx.stroke();
                ctx.fillStyle = color; ctx.fillRect(i*w + 4, Math.min(yO, yC), w-8, Math.max(Math.abs(yO-yC), 1));
            });
        }

        function updateUI() {
            document.getElementById('cashDisp').innerText = `$${Math.floor(Game.cash).toLocaleString()}`;
            document.getElementById('sPrice').innerText = `$${Game.active.price.toFixed(2)}`;
            document.getElementById('qtyDisp').innerText = `Units: ${Game.port[Game.active.sym] || 0}`;
        }

        function resize() { cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight; }
        window.onresize = resize;
    </script>
</body></html>
