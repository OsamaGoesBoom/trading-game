<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <title>QUANTUM APEX // GLOBAL_SYNC</title>
    <style>
        :root { 
            --bg: #010409; --panel: #0d1117; --border: #30363d;
            --cyan: #58a6ff; --magenta: #bc8cff; --green: #3fb950; --red: #f85149; --gold: #d29922;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Courier New', monospace; }
        body { background: var(--bg); color: #c9d1d9; height: 100vh; overflow: hidden; font-size: 13px; }

        /* HACKER TERMINAL OVERLAY */
        #hackerTerminal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; 
            display: none; flex-direction: column; padding: 20px; color: #00ff00;
            text-shadow: 0 0 5px #00ff00;
        }
        #termInput { background: transparent; border: none; color: #00ff00; font-size: 18px; width: 100%; outline: none; }

        .auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: flex; justify-content: center; align-items: center; }
        .auth-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 30px; width: 350px; }
        
        #app { display: grid; grid-template-columns: 280px 1fr 300px; grid-template-rows: 60px 1fr 40px; height: 100vh; gap: 8px; padding: 8px; visibility: hidden; }
        .box { background: var(--panel); border: 1px solid var(--border); border-radius: 6px; padding: 12px; display: flex; flex-direction: column; overflow: hidden; }
        
        .btn { padding: 10px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; background: #21262d; color: #c9d1d9; width: 100%; margin: 5px 0; }
        .btn-primary { background: var(--green); color: #fff; }
        
        input { background: #0d1117; border: 1px solid var(--border); padding: 10px; color: #fff; width: 100%; margin-bottom: 10px; }
        canvas { background: #010409; flex-grow: 1; border: 1px solid var(--border); }
        
        .ticker { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid var(--border); cursor: pointer; }
        .active-t { background: #1c2128; border-left: 3px solid var(--cyan); }
    </style>
</head>
<body>

    <div id="hackerTerminal">
        <div id="termLog" style="flex-grow:1; overflow-y:auto; margin-bottom:10px;">
            [SYSTEM] QUANTUM BYPASS INITIALIZED...<br>
            [CMD] TYPE /give money [amount] TO INJECT CAPITAL.<br>
        </div>
        <div style="display:flex;"><span>root@qa_term:~#&nbsp;</span><input type="text" id="termInput" autofocus></div>
    </div>

    <div id="authScreen" class="auth-overlay">
        <div class="auth-card">
            <h2 style="text-align:center; color:var(--cyan); margin-bottom:15px;">LOGIN_REQUIRED</h2>
            <input type="text" id="username" placeholder="User ID">
            <input type="password" id="password" placeholder="Pass Key">
            <button class="btn btn-primary" onclick="handleAuth('login')">LOGIN</button>
            <button class="btn" onclick="handleAuth('signup')">SIGN UP</button>
            <p id="authError" style="color:var(--red); font-size:11px; margin-top:10px;"></p>
        </div>
    </div>

    <div class="app" id="app">
        <header class="box" style="grid-column: span 3; flex-direction: row; align-items: center; justify-content: space-between;">
            <div><span style="color:var(--cyan)">GLOBAL</span>_SYNC_TERMINAL</div>
            <div id="cashDisp" style="font-size: 22px; color:var(--green)">$0</div>
        </header>
        <aside class="box"><div id="stockList" style="overflow-y:auto;"></div></aside>
        <main class="box">
            <h2 id="sName">--</h2>
            <canvas id="chart"></canvas>
        </main>
        <aside class="box">
            <div id="pnlDisp" style="font-size: 24px;">$0.00</div>
            <div id="qtyDisp" style="color:#8b949e; margin-bottom:15px;">Units: 0</div>
            <button class="btn" style="background:var(--green); color:white" onclick="trade(1)">BUY</button>
            <button class="btn" style="background:var(--red); color:white" onclick="trade(-1)">SELL</button>
            <button class="btn" style="margin-top:auto" onclick="saveGame(true)">MANUAL DATA SAVE</button>
        </aside>
    </div>

    <script>
        let currentUser = null;
        const Game = { cash: 10000, port: {}, active: null };
        const Stocks = [];
        const cvs = document.getElementById('chart'), ctx = cvs.getContext('2d');

        // --- AUTH & STORAGE ---
        function handleAuth(mode) {
            const u = document.getElementById('username').value.trim();
            const p = document.getElementById('password').value.trim();
            let reg = JSON.parse(localStorage.getItem('QA_REG') || '{}');
            if(mode === 'signup') {
                if(reg[u]) return alert("User exists");
                reg[u] = { p, cash: 10000, port: {} };
                localStorage.setItem('QA_REG', JSON.stringify(reg));
                alert("Account Created.");
            } else {
                if(!reg[u] || reg[u].p !== p) return alert("Wrong credentials");
                currentUser = u; Game.cash = reg[u].cash; Game.port = reg[u].port;
                document.getElementById('authScreen').style.display = 'none';
                document.getElementById('app').style.visibility = 'visible';
                initGame();
            }
        }

        function saveGame(manual) {
            let reg = JSON.parse(localStorage.getItem('QA_REG'));
            reg[currentUser].cash = Game.cash;
            reg[currentUser].port = Game.port;
            localStorage.setItem('QA_REG', JSON.stringify(reg));
            if(manual) alert("DATA SECURED TO LOCAL STORAGE");
        }

        // --- GLOBAL SYNC ENGINE ---
        function getPriceAtTime(seed, volatility) {
            // This makes the price dependent on the actual clock time
            const now = Math.floor(Date.now() / 700); // New candle every 0.7s
            let price = 200 + (seed % 100);
            for(let i = 0; i < 50; i++) {
                // Deterministic "random" based on time index and seed
                let pseudoRand = Math.sin((now - (50 - i)) * seed) * 0.5;
                price += price * pseudoRand * volatility;
            }
            return price;
        }

        function initGame() {
            const names = ["SOLAR", "CYBER", "BIO", "VOID", "NEON", "QUANT"];
            for(let i=0; i<10; i++) {
                Stocks.push({ sym: names[i%6]+(10+i), seed: (i+1)*123, vol: 0.02, hist: [] });
            }
            const list = document.getElementById('stockList');
            Stocks.forEach(s => {
                list.innerHTML += `<div class="ticker" id="tk-${s.sym}" onclick="viewStock('${s.sym}')">
                    <b>${s.sym}</b><span id="p-${s.sym}">$0</span>
                </div>`;
            });
            Game.active = Stocks[0];
            setInterval(tick, 700); // Candles every 0.7s
            setInterval(() => updateUI(), 2000); // Investor UI update every 2s
            resize();
        }

        function tick() {
            Stocks.forEach(s => {
                let p = getPriceAtTime(s.seed, s.vol);
                s.price = p;
                s.hist.push({o: p*0.99, c: p, h: p*1.01, l: p*0.98});
                if(s.hist.length > 40) s.hist.shift();
                document.getElementById(`p-${s.sym}`).innerText = `$${p.toFixed(2)}`;
            });
            draw();
        }

        function draw() {
            ctx.clearRect(0,0,cvs.width,cvs.height);
            const h = Game.active.hist; if(h.length < 2) return;
            const w = cvs.width / 40;
            h.forEach((d, i) => {
                const x = i * w + w/2;
                const color = d.c >= d.o ? '#3fb950' : '#f85149';
                ctx.fillStyle = color;
                ctx.fillRect(i*w+2, cvs.height - (d.c/500)*cvs.height, w-4, 10); // Simplified candle
            });
        }

        function viewStock(s) { Game.active = Stocks.find(x=>x.sym===s); }

        function trade(dir) {
            const s = Game.active; if(!Game.port[s.sym]) Game.port[s.sym] = {qty:0, avg:0};
            if(dir === 1 && Game.cash >= s.price) {
                Game.cash -= s.price;
                Game.port[s.sym].avg = (Game.port[s.sym].qty * Game.port[s.sym].avg + s.price) / (++Game.port[s.sym].qty);
            } else if (dir === -1 && Game.port[s.sym].qty > 0) {
                Game.cash += s.price;
                Game.port[s.sym].qty--;
            }
            saveGame();
        }

        function updateUI() {
            document.getElementById('cashDisp').innerText = `$${Math.floor(Game.cash).toLocaleString()}`;
            const p = Game.port[Game.active.sym] || {qty:0, avg:0};
            document.getElementById('qtyDisp').innerText = `Units: ${p.qty} | Avg: $${p.avg.toFixed(2)}`;
        }

        // --- SECRET TERMINAL LOGIC ---
        window.addEventListener('keydown', (e) => {
            if(e.ctrlKey && e.key.toLowerCase() === 'q' || e.key.toLowerCase() === 'a') {
                // Simple combo check
                if(e.ctrlKey && (e.code === 'KeyQ' || e.code === 'KeyA')) {
                    const term = document.getElementById('hackerTerminal');
                    term.style.display = term.style.display === 'flex' ? 'none' : 'flex';
                    if(term.style.display === 'flex') document.getElementById('termInput').focus();
                }
            }
        });

        document.getElementById('termInput').addEventListener('keydown', (e) => {
            if(e.key === 'Enter') {
                const val = e.target.value;
                const log = document.getElementById('termLog');
                if(val.startsWith('/give money ')) {
                    const amt = parseInt(val.replace('/give money ', ''));
                    Game.cash += amt;
                    log.innerHTML += `<br>> INJECTED $${amt} INTO BUFFER...`;
                } else if(val === 'exit') {
                    document.getElementById('hackerTerminal').style.display = 'none';
                }
                e.target.value = '';
            }
        });

        function resize() { cvs.width = cvs.offsetWidth; cvs.height = cvs.offsetHeight; }
        window.onresize = resize;
    </script>
</body></html>
